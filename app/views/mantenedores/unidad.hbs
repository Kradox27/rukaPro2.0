<!-- Page header -->
<div class="page-header page-header-light">
    <div class="page-header-content header-elements-md-inline">
        <div class="page-title d-flex">
            <h4><i class="icon-grid2 mr-2 ml-1"></i> <span class="font-weight-semibold text-bluedark">Unidades del
                    Sistema</span></h4>
            <a href="/" class="header-elements-toggle text-default d-md-none"><i class="icon-more"></i></a>
        </div>
        {{#if (eqBool user.habilitado) }}
        <div class="header-elements d-none">
            <div class="d-flex justify-content-center">
                <button id="btnCrearU" type="button"
                    class="btn btn-outline btn-sm bg-RukaPro text-RukaPro border-RukaPro d-inline-block">Crear
                    Unidad</button>
                &nbsp
                <button id="btnCrearUC" type="button"
                    class="btn btn-outline btn-sm bg-RukaPro text-RukaPro border-RukaPro d-inline-block">Crear
                    Unidad Común</button>
            </div>
        </div>
        {{/if}}
    </div>
</div>
<!-- /page header -->

<!-- Begin Page Content -->
<div class="content">
    <!-- Informacion -->
    {{>infoComunidad}}

    <!--Informacion Unidad Prorratero-->
    <div class="card border-bottom-RukaPro">
        <a class="btn btn-light" data-toggle="collapse" href="#infoProrrateo" role="button" aria-expanded="false"
            aria-controls="collapseExample">
            <h4><span class="fa-pull-right"><i class="icon-arrow-down12"></i></span>Información Prorrateo</h4>
        </a>
        <div class="collapse" id="infoProrrateo">
            <div class="card-body border-bottom-info">
                <form autocomplete="off">
                    <div class="row row-lg">
                        <div class="col-sm-12 col-lg-12 center-block">
                            <div class="form-group form-material row d-flex justify-content-center">
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Cantidad Departamentos:</label>
                                    <input id="dptoInfo" type="text" class="form-control text-center" disabled>
                                </div>
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Cantidad Casas:</label>
                                    <input id="casaInfo" type="text" class="form-control text-center" disabled>
                                </div>
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Cantidad Bodegas:</label>
                                    <input id="bodegaInfo" type="text" class="form-control text-center" disabled>
                                </div>
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Cantidad Estacionamientos:</label>
                                    <input id="estInfo" type="text" class="form-control text-center" disabled>
                                </div>
                            </div>
                            <div class="form-group form-material row d-flex justify-content-center">
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Total Unidades:</label>
                                    <input id="cantidadInfo" type="text" class="form-control text-center" disabled>
                                </div>
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Total Area:</label>
                                    <input id="areaInfo" type="text" class="form-control text-center" disabled>
                                </div>
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Total Prorrateo:</label>
                                    <input id="prorrateoInfo" type="text" class="form-control text-center" maxlength="9"
                                        disabled>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!--Filtro-->
    <div class="card border-bottom-RukaPro">
        <a class="btn btn-light" data-toggle="collapse" href="#filtro" role="button" aria-expanded="false"
            aria-controls="collapseExample">
            <h4><span class="fa-pull-right"><i class="icon-arrow-down12"></i></span>Filtros</h4>
        </a>
        <div class="collapse" id="filtro">
            <div class="card-body border-bottom-info">
                <form autocomplete="off" id='form-buscar'>
                    <div class="row row-lg">
                        <div class="col-sm-12 col-lg-12 center-block">
                            <div class="form-group form-material row d-flex justify-content-center">
                                <div class="col-sm-2">
                                    <label class="col-sm-12 control-label">Tipo de Origen</label>
                                    <select id="tipoOrigenFiltro" data-plugin="select2" class="form-control">
                                        <option value="T" selected>TODOS</option>
                                        <option value="U">UNIDAD</option>
                                        <option value="UC">UNIDAD COMÚN</option>
                                    </select>
                                </div>
                                <div id="divTipoUnidad" class="col-sm-3">
                                    <label class="col-sm-12 control-label">Tipo de Unidad</label>
                                    <select id="tipoUnidadFiltro" data-plugin="select2" class="form-control"
                                        disabled="true">
                                    </select>
                                </div>
                                <div class="col-sm-1">
                                    <br />
                                    <div class="mt-1">
                                        <button class="btn btn-animate btn-animate-vertical bg-RukaPro form-control"
                                            name="Buscar" type="submit" value="Buscar">
                                            <span>Buscar <i aria-hidden="true" class="fa fa-search"></i></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Contenido -->
    <div class="card border-bottom-RukaPro" id="tabla-panel">
        <a href="#collapseCardOne"
            class="card-header py-2 d-sm-flex text-RukaPro align-items-center justify-content-between mb-4"
            data-toggle="collapse" role="button" aria-expanded="true" aria-controls="collapseCardOne">
            <h5 class="m-0 font-weight-bold text-bluedark d-inline-block">Listado de Unidades</h5>
        </a>
        <div class="card-body border-bottom-info">
            <div class="table-responsive">
                <table class="table table-sm table-striped table-hover" id="tablaDT" width="100%" cellspacing="0">
                    <thead>
                        <tr style="">
                            <th rowspan="2">Nº</th>
                            <th rowspan="2">Tipo de Origen</th>
                            <th rowspan="2">Tipo de Unidad</th>
                            <th colspan="1" style="text-align: center;">Unidades Comunes</th>
                            <th colspan="6" style="text-align: center;">Unidades</th>
                        </tr>
                        <tr>
                            <th colspan="1">Nombre Unidad Común</th>
                            <th>Unidad Asociada</th>
                            <th>Numero Unidad</th>
                            <th>Rol Unidad</th>
                            <th>Area Unidad (M²)</th>
                            <th>Prorrateo</th>
                            <th>Codigo Unico</th>
                            <th class="th-sm" width="10%">Acciones</th>
                        </tr>
                        </thread>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{{#if (eqBool user.habilitado) }}
<!-- Inicio Modal Unidad-->
<div class="modal fade" id="modal-unidad">
    <div class="container-fluid">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="">
                    <h4 class="modal-title mb-0" id="modal-titulo-U"></h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="row">
                        <div class="form-group col-md-6 text-bluedark">
                            <label>Tipo Unidad</label>
                            <select id="tipoUnidad" name="codigoTipoUnidad" style="width:100%;"
                                data-plugin="select2"></select>
                        </div>
                        <div id="divTipoPadre" class="form-group col-md-6 text-bluedark">
                            <label>Unidad Asociada</label>
                            <select id="idUnidadPadre" name="idUnidadPadre" style="width:100%;"
                                data-plugin="select2"></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6 text-bluedark">
                            <label>Rol Unidad</label>
                            <input id="rolUnidad" type="text" class="form-control" name="rolUnidad">
                        </div>
                        <div class="form-group col-md-6 text-bluedark">
                            <label>Numero Unidad</label>
                            <input id="numeroUnidad" type="text" class="form-control" name="numeroUnidad">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6 text-bluedark">
                            <label>Area Unidad (M²)</label>
                            <input id="areaUnidad" type="text" name="areaUnidad" size="10"
                                class="form-control text-center noPaste soloNumeroDecimal_2" />
                        </div>
                        <div class="form-group col-md-6 text-bluedark">
                            <label>Prorrateo</label>
                            <input id="prorrateo" type="text" class="form-control text-center noPaste prorrateo"
                                maxlength="9">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6 text-bluedark">
                            <label>Nombre Arrendatario</label>
                            <input id="nombreArrendatario" type="text" class="form-control" name="nombreArrendatario">
                        </div>
                        <div class="form-group col-md-6 text-bluedark">
                            <label>Correo Arrendatario</label>
                            <input id="correoArrendatario" type="text" class="form-control" name="correoArrendatario">
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <div class="form-group">
                        <button type="button" class="btn btn-success botonAccion-U"><i
                                class="fa fa-database"></i>&nbsp;&nbsp;&nbsp;Guardar&nbsp;&nbsp;</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal"><i
                                class="fa fa-clone"></i>&nbsp;&nbsp;&nbsp;Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Inicio Modal Unidad Comun-->
<div class="modal fade" id="modal-unidadComun">
    <div class="container-fluid">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="">
                    <h4 class="modal-title mb-0" id="modal-titulo-UC"></h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="form-group text-bluedark">
                        <label>Tipo Unidad Comun</label>
                        <select id="tipoUnidadComun" class="form-control" name="tipoUnidadComun"></select>
                    </div>
                    <div class="form-group text-bluedark">
                        <label>Nombre Unidad Comun</label>
                        <input id="nombreUnidadComun" type="text" class="form-control" name="nombreUnidadComun">
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <div class="form-group">
                        <button type="button" class="btn btn-success botonAccion-UC"><i
                                class="fa fa-database"></i>&nbsp;&nbsp;&nbsp;Guardar&nbsp;&nbsp;</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal"><i
                                class="fa fa-clone"></i>&nbsp;&nbsp;&nbsp;Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{/if}}

<script nonce="{{nonce}}">
    'use strict'

    var idComunidad = "{{ idComunidad }}";

    $(document).ready(function () {
        buscarUnidades();
        $("#tipoUnidadFiltro").prop("disabled", true);
        $('[data-toggle="tooltip"]').tooltip();
        tipoUnidadList();
    });

    function buscarUnidades() {
        $.ajax({
            method: "POST",
            url: "/mantenedor/unidades/buscarUnidadesAll",
            dataType: 'json',
            data: { idComunidad: idComunidad },
            beforeSend: loading()
        })
            .done(function (data) {
                Swal.close();
                if (data.ok) {
                    renderTable(data.ok.all)
                    detalleProrrateo(data.ok)
                }
                if (data.error) Swal.fire('Error', data.error, 'error');
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                Swal.close();
                console.log("Error al buscar: ", errorMessage(jqXHR, textStatus, errorThrown))
            })
    }

    $('#tipoOrigenFiltro').on('change', (e) => {
        let aux = e.target.value;
        switch (e.target.value) {
            case "T":
                $("#tipoUnidadFiltro").prop("disabled", true);
                $("#tipoUnidadFiltro").empty()
                $("#tipoUnidadFiltro").select2('destroy');
                break;
            case "U":
                $("#tipoUnidadFiltro").empty()
                comboTipoUnidad("#tipoUnidadFiltro", "UNIDAD")
                $("#tipoUnidadFiltro").prop("disabled", false);
                break;
            case "UC":
                $("#tipoUnidadFiltro").empty()
                comboTipoUnidad("#tipoUnidadFiltro", "UNIDADCOMUN")
                $("#tipoUnidadFiltro").prop("disabled", false);
                break;
        }
    });

    $('#form-buscar').submit(function (e) {
        e.preventDefault()
        $.ajax({
            method: "POST",
            url: "/mantenedor/unidades/buscarUnidadesFiltro",
            dataType: 'json',
            data: {
                tipo: $("#tipoOrigenFiltro").val(),
                tipoUnidad: $("#tipoUnidadFiltro").val(),
                idComunidad: parseInt(idComunidad)
            },
            beforeSend: loading()
        })
            .done(function (data) {
                Swal.close();
                if (data.ok) renderTable(data.ok.all)
                if (data.error) Swal.fire('Error', data.error, 'error');
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                Swal.close();
                console.log("Error al buscar: ", errorMessage(jqXHR, textStatus, errorThrown))
            })
    })

    '{{#if (eqBool user.habilitado) }}'
    $('#tipoUnidad').on('select2:select', (e) => {
        let tipoUnidad = $("body").data("tipoUnidadSelect2").find(tu => tu.codigoTipoUnidad == e.params.data.id);
        if (tipoUnidad.nivel == 2) {
            if ($('.botonAccion-U').attr('id') == 'editarU') {
                let row = $('#tablaDT').DataTable().rows().data().toArray().find(e => e.id + e.tipoOrigen == $('#modal-unidad').data('id') + 'U');
                $('#idUnidadPadre').val(row.idUnidadPadre).trigger('change');
            }
            $('#divTipoPadre').fadeIn();
        } else $('#divTipoPadre').fadeOut();
    });

    $('.modal').on('hidden.bs.modal', () => {
        $('.modal').find("input").val("").removeClass('invalid');
        $('.modal').find('span.select2-selection').removeClass("invalid").attr({ 'style': '' });
        $('#tipoUnidad,#tipoUnidadComun').val(null).trigger('change');
        $('#idUnidadPadre').val(null).trigger('change');
    })

    /*----------------------UNIDAD--------------------------------------------*/
    $("#btnCrearU").on('click', () => {
        comboTipoUnidad('#tipoUnidad', 'UNIDAD');
        unidadAsociadaSelect2N("#idUnidadPadre", idComunidad)
        $('#divTipoPadre').hide();
        $('.botonAccion-U').attr('id', 'agregarU');
        $('#modal-titulo-U').text("Nueva Unidad").parent().attr('class', 'modal-header bg-RukaPro')
        $('#modal-unidad').modal('show');
    });

    $(document).on('click', '#agregarU', () => {
        let validar = true;
        if (!validarEmail($("#correoArrendatario").val())) validar = validarMensaje('#correoArrendatario', 'Ingrese un correo valido.', 'i');
        if ($("#tipoUnidad").val() == null) validar = validarMensaje('#tipoUnidad', 'Seleccione un Tipo Unidad.', 's');
        if ($("#prorrateo").val() == "") validar = validarMensaje('#tasaInteres', 'Ingrese un Prorrateo.', 'i');
        if (parseFloat($('#prorrateo').val()) > 100) validar = validarMensaje('#tasaInteres', 'Valor no puede ser mayor a 100%.', 'i');
        if (validar) {
            $.ajax({
                method: 'POST',
                dataType: 'json',
                url: "/mantenedor/unidades/crearUnidad",
                data: {
                    codigoTipoUnidad: $("#tipoUnidad").val(),
                    numeroUnidad: $("#numeroUnidad").val(),
                    rolUnidad: $("#rolUnidad").val(),
                    idComunidad: parseInt(idComunidad),
                    areaUnidad: $("#areaUnidad").val(),
                    idUnidadPadre: $("#idUnidadPadre").val(),
                    prorrateo: $("#prorrateo").val(),
                    nombreArrendatario: $("#nombreArrendatario").val(),
                    correoArrendatario: $("#correoArrendatario").val()
                },
                beforeSend: loading()
            })
                .done(function (data) {
                    Swal.close();
                    if (data.ok) {
                        agregarDT('#tablaDT', data.ok);
                        $("#idUnidadPadre").empty();
                        detalleProrrateo(data.ok);
                        Swal.fire('Éxito', 'Unidad ingresada.', 'success')
                        $('.modal').modal('hide')
                    }
                    if (data.error) Swal.fire('Error', data.error, 'error');
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    Swal.close();
                    console.log("Error al crear: ", errorMessage(jqXHR, textStatus, errorThrown))
                })
        }
    });

    $(document).on('click', '#editarU', () => {
        let validar = true;
        if (!validarEmail($("#correoArrendatario").val())) validar = validarMensaje('#correoArrendatario', 'Ingrese un correo valido.','i');
        if ($("#tipoUnidad").val() == null) validar = validarMensaje('#tipoUnidad', 'Ingrese un Tipo Unidad.','s');
        if ($("#prorrateo").val() == "") validar = validarMensaje('#tasaInteres', 'Ingrese un Prorrateo.','i');
        if (parseFloat($('#prorrateo').val()) > 100) validar = validarMensaje('#tasaInteres', 'Valor no puede ser mayor a 100%.','i');
        if (validar) {
            var id = $('#modal-unidad').data('id')
            $.ajax({
                method: 'PUT',
                dataType: 'json',
                url: "/mantenedor/unidades/editarUnidad/" + id,
                data: {
                    codigoTipoUnidad: $("#tipoUnidad").val(),
                    numeroUnidad: $("#numeroUnidad").val(),
                    rolUnidad: $("#rolUnidad").val(),
                    idComunidad: parseInt(idComunidad),
                    areaUnidad: $("#areaUnidad").val(),
                    idUnidadPadre: $("#idUnidadPadre").val() != null ? $("#idUnidadPadre").val() : 0,
                    prorrateo: $("#prorrateo").val(),
                    nombreArrendatario: $("#nombreArrendatario").val(),
                    correoArrendatario: $("#correoArrendatario").val(),
                    valorAntiguoProrrateo: $('#modal-unidad').data('valorAntiguoProrrateo'),
                    valorAntiguoPadre: $('#modal-unidad').data('valorAntiguoPadre')
                },
                beforeSend: loading()
            })
                .done(function (data) {
                    Swal.close();
                    if (data.ok) {
                        editarDT('#tablaDT', id + "U", data.unidad)
                        detalleProrrateo(data.unidad);
                        Swal.fire('Éxito', data.ok, 'success');
                        $('.modal').modal('hide')
                    }
                    if (data.error) Swal.fire('Error', data.error, 'error');
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    Swal.close();
                    console.log("Error al editar: ", errorMessage(jqXHR, textStatus, errorThrown))
                })
        }
    });

    /*----------------------UNIDAD COMUN--------------------------------------*/
    $("#btnCrearUC").on('click', () => {
        comboTipoUnidad('#tipoUnidadComun', 'UNIDADCOMUN');
        $('.botonAccion-UC').attr('id', 'agregarUC');
        $('#modal-titulo-UC').text("Nueva Unidad Común").parent().attr('class', 'modal-header bg-RukaPro')
        $('#modal-unidadComun').modal('show');
    });

    $(document).on('click', '#agregarUC', () => {
        let validar = true;
        if ($("#tipoUnidadComun").val() == null) validar = validarMensaje('#tipoUnidadComun', 'Ingrese un Tipo Unidad Común.','s');
        if ($("#nombreUnidadComun").val() == "") validar = validarMensaje('#nombreUnidadComun', 'Ingrese un Nombre de Unidad Común.','i');
        if (validar) {
            $.ajax({
                method: 'POST',
                dataType: 'json',
                url: "/mantenedor/unidades/crearUnidadComun",
                data: {
                    codigoTipoUnidad: $("#tipoUnidadComun").val(),
                    nombreUnidadComun: $("#nombreUnidadComun").val(),
                    idComunidad: parseInt(idComunidad)
                },
                beforeSend: loading()
            })
                .done(function (data) {
                    Swal.close();
                    if (data.ok) {
                        agregarDT('#tablaDT', data.ok);
                        Swal.fire("Éxito", 'Unidad Común ingresada.', 'success')
                        $('.modal').modal('hide')
                    }
                    if (data.error) Swal.fire('Error', data.error, 'error');
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    Swal.close();
                    console.log("Error al crear: ", errorMessage(jqXHR, textStatus, errorThrown))
                })
        }
    });

    $(document).on('click', '#editarUC', () => {
        let validar = true;
        if ($("#tipoUnidadComun").val() == null) validar = validarMensaje('#tipoUnidadComun', 'Ingrese un Tipo Unidad Común.','s');
        if ($("#nombreUnidadComun").val() == "") validar = validarMensaje('#nombreUnidadComun', 'Ingrese un Nombre de Unidad Común.','i');
        if (validar) {
            var id = $('#modal-unidadComun').data('id')
            $.ajax({
                method: 'PUT',
                dataType: 'json',
                url: "/mantenedor/unidades/editarUnidadComun/" + id,
                data: {
                    codigoTipoUnidad: $("#tipoUnidadComun").val(),
                    nombreUnidadComun: $("#nombreUnidadComun").val(),
                    idComunidad: parseInt(idComunidad)
                },
                beforeSend: loading()
            })
                .done(function (data) {
                    Swal.close();
                    if (data.ok) {
                        editarDT('#tablaDT', id + "UC", data.unidadComun)
                        Swal.fire('Éxito', data.ok, 'success')
                        $('.modal').modal('hide')
                    }
                    if (data.error) Swal.fire('Error', data.error, 'error');
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    Swal.close();
                    console.log("Error al editar: ", errorMessage(jqXHR, textStatus, errorThrown))
                })
        }
    });

    $(document).on('click', 'button[name="btnEditar"]', function () {
        let id = $(this).attr("id");
        let tipo = $(this).attr("data-tipoOrigen");
        let row = $('#tablaDT').DataTable().rows().data().toArray().find(e => e.id + e.tipoOrigen == id + tipo);
        switch (tipo) {
            case 'UC':
                comboTipoUnidad('#tipoUnidadComun', 'UNIDADCOMUN');
                $('#nombreUnidadComun').val(row.nombreUnidadComun);
                $('#tipoUnidadComun').val(row.tipounidad.codigoTipoUnidad).trigger('change');

                $('.botonAccion-UC').attr('id', 'editarUC');
                $('#modal-titulo-UC').text("Editar Unidad").parent().attr('class', 'modal-header bg-primary')
                $('#modal-unidadComun').data('id', id).modal('show');
                break;
            case 'U':
                unidadAsociadaSelect2N("#idUnidadPadre", idComunidad, row.idUnidadPadre);
                comboTipoUnidad('#tipoUnidad', 'UNIDAD');
                if (row.tipounidad.nivel == 2) $('#divTipoPadre').fadeIn();
                else $('#divTipoPadre').fadeOut();
                $('#numeroUnidad').val(row.numeroUnidad);
                $('#rolUnidad').val(row.rolUnidad);
                $('#areaUnidad').val(row.areaUnidad);
                $('#prorrateo').val(row.prorrateo);
                $('#tipoUnidad').val(row.tipounidad.codigoTipoUnidad).trigger('change');
                $('#nombreArrendatario').val(row.nombreArrendatario);
                $('#correoArrendatario').val(row.correoArrendatario);

                $('.botonAccion-U').attr('id', 'editarU');
                $('#modal-titulo-U').text("Editar Unidad").parent().attr('class', 'modal-header bg-primary')
                $('#modal-unidad').data('valorAntiguoProrrateo', row.prorrateo).data('valorAntiguoPadre', row.idUnidadPadre).data('id', id).modal('show');
                break;
        }
    });
    '{{/if}}'

    function renderTable(datos) {
        $("#tablaDT").dataTable().fnClearTable();
        $("#tablaDT").dataTable().fnDestroy();
        var columnas = [
            { "data": "" },
            { "data": "tipoOrigen" },
            { "data": "tipounidad.descripcionTipo" },
            { "data": "nombreUnidadComun" },
            { "data": "idUnidadPadre" },
            { "data": "numeroUnidad" },
            { "data": "rolUnidad" },
            { "data": "areaUnidad" },
            { "data": "prorrateo" },
            { "data": "codigoUnico" },
            { "data": "id" }
        ];

        var columnaDefs = [
            {
                render: function (data, type, row, meta) { return meta.row + 1; },
                className: "text-center",
                targets: 0
            },
            {
                render: function (data, type, row, meta) {
                    switch (data) {
                        case "U": return "UNIDAD"; break;
                        case "UC": return "UNIDAD COMÚN"; break;
                    }
                },
                targets: 1
            },
            {
                width: "30%",
                className: "text-center",
                targets: 3
            },
            {
                render: function (data, type, row, meta) {
                    return data != 0 ? row.unidadPadre.tipounidad.descripcionTipo + '/' + row.unidadPadre.numeroUnidad + '/' + row.unidadPadre.rolUnidad : "";
                },
                targets: 4
            },
            {
                render: function (data, type, row, meta) { return data != "" ? data + '%' : ""; },
                className: "text-center",
                targets: 8
            },
            {
                render: function (data, type, row, meta) {
                    let iconEditar = '';
                    '{{#if (eqBool user.habilitado) }}'
                    iconEditar = `<button id=${data} type='button' class='btn btn-default' name='btnEditar' data-tipoOrigen='${row.tipoOrigen}' data-toggle='tooltip' data-original-title='Editar' data-trigger='hover'><i class='icon-pencil text-primary fa-lg' aria-hidden='true'></i></button>`;
                    '{{/if}}'
                    return iconEditar;
                },
                width: "15%",
                className: "text-center",
                targets: 10
            }
        ];

        var rowId = function (a) { return a.id + a.tipoOrigen }

        createTableData("#tablaDT", datos, columnas, columnaDefs, rowId);
    }

    function detalleProrrateo(data) {
        let unidades = $('#tablaDT').DataTable().rows().data().filter(x => x.tipoOrigen == "U");
        $("#dptoInfo").val(unidades.filter(e => e.tipounidad.codigoTipoUnidad == 'DPTO').length);
        $("#casaInfo").val(unidades.filter(e => e.tipounidad.codigoTipoUnidad == 'CASA').length);
        $("#bodegaInfo").val(unidades.filter(e => e.tipounidad.codigoTipoUnidad == 'BOD').length);
        $("#estInfo").val(unidades.filter(e => e.tipounidad.codigoTipoUnidad == 'EST').length);
        $("#areaInfo").val(data.totalAreaFinal);
        $("#cantidadInfo").val(data.totalCantidad);
        $("#prorrateoInfo").val(data.totalProrrateoFinal);
    }

    function comboTipoUnidad(selector, tipo) {
        let data = $("body").data("tipoUnidadSelect2").filter(e => e.tipo == tipo);
        $(selector).empty();
        $(selector).select2({
            data: $.map(data, function (a, b) { return { id: a.codigoTipoUnidad, text: a.descripcionTipo } }),
            containerCssClass: "form-control",
            dropdownCssClass: "custom-dropdown",
            allowClear: false,
            placeholder: tipo == 'UNIDAD' ? 'Seleccione Tipo Unidad' : 'Seleccione Tipo Unidad Común',
            width: '100%'
        }).val(null).trigger('change');
    }

</script>